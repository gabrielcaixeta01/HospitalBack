generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum Sexo {
  M
  F
  O
}


model Paciente {
  id          BigInt   @id @default(autoincrement())
  nome        String   @db.VarChar(120)
  cpf         String   @unique @db.VarChar(14)
  nascimento  DateTime @db.Date
  sexo        Sexo?
  telefone    String?  @db.VarChar(40)
  email       String?  @db.VarChar(120)
  observacoes String?  @db.Text

  consultas   Consulta[]
  internacoes Internacao[]

  @@map("paciente")
}

model Medico {
  id       BigInt  @id @default(autoincrement())
  nome     String  @db.VarChar(120)
  crm      String? @unique @db.VarChar(40)
  email    String? @db.VarChar(120)
  telefone String? @db.VarChar(40)

  consultas Consulta[]

  especialidades Especialidade[]

  @@map("medico")
}

model Especialidade {
  id   BigInt @id @default(autoincrement())
  nome String @unique @db.VarChar(80)

  medicos Medico[]

  @@map("especialidade")
}


model Consulta {
  id       BigInt   @id @default(autoincrement())
  dataHora DateTime
  motivo   String?  @db.VarChar(255)
  notas    String?  @db.Text

  medicoId   BigInt
  pacienteId BigInt

  medico   Medico   @relation(fields: [medicoId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  exames   Exame[]

  @@index([medicoId])
  @@index([pacienteId])
  @@map("consulta")
}

model Exame {
  id        BigInt    @id @default(autoincrement())
  tipo      String    @db.VarChar(120)
  resultado String?   @db.Text
  dataHora  DateTime?

  consultaId BigInt
  consulta   Consulta @relation(fields: [consultaId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  @@index([consultaId])
  @@map("exame")
}

model Leito {
  id     BigInt @id @default(autoincrement())
  codigo String @unique @db.VarChar(40)
  status String @db.VarChar(40)

  internacoes Internacao[]

  @@map("leito")
}

model Internacao {
  id          BigInt    @id @default(autoincrement())
  pacienteId  BigInt
  leitoId     BigInt
  dataEntrada DateTime
  dataAlta    DateTime?

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  leito    Leito    @relation(fields: [leitoId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  @@index([pacienteId])
  @@index([leitoId])
  @@map("internacao")
}