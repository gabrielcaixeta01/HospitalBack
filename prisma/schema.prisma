generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Consulta {
  id              BigInt   @id @default(autoincrement())
  dataHora        DateTime
  motivo          String?  @db.VarChar(255)
  notas           String?
  medicoId        BigInt
  pacienteId      BigInt
  especialidadeId BigInt
  medico          Medico   @relation(fields: [medicoId], references: [id])
  paciente        Paciente @relation(fields: [pacienteId], references: [id])
  especialidade   Especialidade @relation(fields: [especialidadeId], references: [id])
  exame           Exame[]
  prescricao      Prescricao[]

  @@index([medicoId])
  @@index([pacienteId])
  @@index([especialidadeId])
  @@map("consulta")
}

model Especialidade {
  id                  BigInt   @id @default(autoincrement())
  nome                String   @unique @db.VarChar(80)
  
  consulta            Consulta[]
  medico             Medico[] @relation("EspecialidadeToMedico")

  @@map("especialidade")
}

model Exame {
  id         BigInt    @id @default(autoincrement())
  tipo       String    @db.VarChar(120)
  resultado  String?
  dataHora   DateTime?
  consultaId BigInt
  consulta   Consulta  @relation(fields: [consultaId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([consultaId])
  @@map("exame")
}

model Internacao {
  id          BigInt    @id @default(autoincrement())
  pacienteId  BigInt
  leitoId     BigInt
  dataEntrada DateTime
  dataAlta    DateTime?
  leito       Leito     @relation(fields: [leitoId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  paciente    Paciente  @relation(fields: [pacienteId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([leitoId])
  @@index([pacienteId])
  @@map("internacao")
}

model Leito {
  id         BigInt       @id @default(autoincrement())
  codigo     String       @unique @db.VarChar(40)
  status     String       @db.VarChar(40)
  internacao Internacao[]

  @@map("leito")
}

model Medico {
  id       BigInt   @id @default(autoincrement())
  nome     String   @db.VarChar(120)
  crm      String?  @unique @db.VarChar(40)
  email    String?  @db.VarChar(120)
  telefone String?  @db.VarChar(40)

  consulta      Consulta[]
  especialidade Especialidade[] @relation("EspecialidadeToMedico")

  @@map("medico")
}

model Paciente {
  id          BigInt       @id @default(autoincrement())
  nome        String       @db.VarChar(120)
  cpf         String       @unique @db.VarChar(14)
  nascimento  DateTime     @db.Date
  sexo        Sexo?
  telefone    String?      @db.VarChar(40)
  email       String?      @db.VarChar(120)
  observacoes String?
  consulta    Consulta[]
  internacao  Internacao[]
  arquivoClinico ArquivoClinico[]

  @@map("paciente")
}

enum Sexo {
  M
  F
  O
}

model Prescricao {
  id BigInt @id @default(autoincrement())
  texto String @db.Text

  consultaId BigInt

  consulta Consulta @relation(fields: [consultaId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([consultaId])
  @@map("prescricao")
}


model ArquivoClinico {
  id BigInt @id @default(autoincrement())
  pacienteId BigInt
  nome_arquivo String @db.VarChar(180)
  mime_type String @db.VarChar(80)

  conteudo Bytes @db.ByteA 
  criado_em DateTime @default(now())

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([pacienteId])
  @@map("arquivo_clinico")
}
