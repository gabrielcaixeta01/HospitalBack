generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model consulta {
  id         BigInt   @id @default(autoincrement())
  dataHora   DateTime
  motivo     String?  @db.VarChar(255)
  notas      String?
  medicoId   BigInt
  pacienteId BigInt
  medico     medico   @relation(fields: [medicoId], references: [id])
  paciente   paciente @relation(fields: [pacienteId], references: [id])
  exame      exame[]

  @@index([medicoId])
  @@index([pacienteId])
}

model especialidade {
  id     BigInt   @id @default(autoincrement())
  nome   String   @unique @db.VarChar(80)
  medico medico[] @relation("EspecialidadeToMedico")
}

model exame {
  id         BigInt    @id @default(autoincrement())
  tipo       String    @db.VarChar(120)
  resultado  String?
  dataHora   DateTime?
  consultaId BigInt
  consulta   consulta  @relation(fields: [consultaId], references: [id])

  @@index([consultaId])
}

model internacao {
  id          BigInt    @id @default(autoincrement())
  pacienteId  BigInt
  leitoId     BigInt
  dataEntrada DateTime
  dataAlta    DateTime?
  leito       leito     @relation(fields: [leitoId], references: [id])
  paciente    paciente  @relation(fields: [pacienteId], references: [id])

  @@index([leitoId])
  @@index([pacienteId])
}

model leito {
  id         BigInt       @id @default(autoincrement())
  codigo     String       @unique @db.VarChar(40)
  status     String       @db.VarChar(40)
  internacao internacao[]
}

model medico {
  id            BigInt          @id @default(autoincrement())
  nome          String          @db.VarChar(120)
  crm           String?         @unique @db.VarChar(40)
  email         String?         @db.VarChar(120)
  telefone      String?         @db.VarChar(40)
  consulta      consulta[]
  especialidade especialidade[] @relation("EspecialidadeToMedico")
}

model paciente {
  id          BigInt       @id @default(autoincrement())
  nome        String       @db.VarChar(120)
  cpf         String       @unique @db.VarChar(14)
  nascimento  DateTime     @db.Date
  sexo        Sexo?
  telefone    String?      @db.VarChar(40)
  email       String?      @db.VarChar(120)
  observacoes String?
  consulta    consulta[]
  internacao  internacao[]
}

enum Sexo {
  M
  F
  O
}

model Prescricao {
  id BigInt @id @default(autoincrement())
  texto String @db.Text

  consultaId BigInt

  consulta Consulta @relation(fields: [consultaId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([consultaId])
  @@map("prescricao")
}


model ArquivoClinico {
  id BigInt @id @default(autoincrement())
  pacienteId BigInt
  nome_arquivo String @db.VarChar(180)
  mime_type String @db.VarChar(80)

  conteudo Bytes @db.ByteA 
  criado_em DateTime @default(now())

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([pacienteId])
  @@map("arquivo_clinico")
}


model MedicoEspecialidade {
  id BigInt @id @default(autoincrement())
  medicoId BigInt
  especialidadeId BigInt

  medico Medico @relation(fields: [medicoId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  especialidade Especialidade @relation(fields: [especialidadeId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  @@unique([medicoId, especialidadeId]) 
  @@index([medicoId])
  @@index([especialidadeId])
  @@map("medico_especialidade")
}